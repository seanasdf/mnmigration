panel.ontop=TRUE,
axis.ticks.x=element_blank(),
axis.ticks.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x=element_text(size=10, color="black"),
axis.text.y=element_blank(),
legend.title=element_blank(),
legend.position="bottom"
) +
scale_y_continuous(labels=scales::comma) +
scale_fill_discrete(labels=c("Moved from MN", "Moved to MN"))
barplot17
library(ggplot2)
barplot17 <- filter(netmig_long, agegroup=="17 to 23") %>%
ggplot(aes(x=geogroup, y=mig, fill=direction)) +
geom_bar(stat="identity", position="dodge") +
geom_text(aes(x=geogroup, y=mig, label=scales::comma(mig)),
position=position_dodge(width=0.9), vjust=-0.25) +
theme(
panel.background = element_blank(),
panel.grid.major.y = element_line(colour = "white",size=.5),
panel.grid.minor.y = element_line(colour = "white", size=.5),
panel.ontop=TRUE,
axis.ticks.x=element_blank(),
axis.ticks.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x=element_text(size=10, color="black"),
axis.text.y=element_blank(),
legend.title=element_blank(),
legend.position="bottom"
) +
scale_y_continuous(labels=scales::comma) +
scale_fill_discrete(labels=c("Moved from MN", "Moved to MN")) +
labs(title="Average Annual Migration between Minnesota and Other States\nPersons Ages 17 to 23")
barplot17
library(ggplot2)
barplot17 <- filter(netmig_long, agegroup=="17 to 23") %>%
ggplot(aes(x=geogroup, y=mig, fill=direction)) +
geom_bar(stat="identity", position="dodge") +
geom_text(aes(x=geogroup, y=mig, label=scales::comma(mig)),
position=position_dodge(width=0.9), vjust=-0.25) +
theme(
panel.background = element_blank(),
panel.grid.major.y = element_line(colour = "white",size=.5),
panel.grid.minor.y = element_line(colour = "white", size=.5),
panel.ontop=TRUE,
axis.ticks.x=element_blank(),
axis.ticks.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x=element_text(size=10, color="black"),
axis.text.y=element_blank(),
legend.title=element_blank(),
legend.position="bottom"
) +
scale_y_continuous(labels=scales::comma) +
scale_fill_discrete(labels=c("Moved from MN", "Moved to MN")) +
labs(title="Average Annual Migration between Minnesota and Other States\nAges 17 to 23")
barplot17
library(ggplot2)
barplot17 <- filter(netmig_long, agegroup=="17 to 23") %>%
ggplot(aes(x=geogroup, y=mig, fill=direction)) +
geom_bar(stat="identity", position="dodge") +
geom_text(aes(x=geogroup, y=mig, label=scales::comma(mig)),
position=position_dodge(width=0.9), vjust=-0.25) +
theme(
panel.background = element_blank(),
panel.grid.major.y = element_line(colour = "white",size=.5),
panel.grid.minor.y = element_line(colour = "white", size=.5),
panel.ontop=TRUE,
axis.ticks.x=element_blank(),
axis.ticks.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x=element_text(size=10, color="black"),
axis.text.y=element_blank(),
legend.title=element_blank(),
legend.position="bottom",
plot.margin = unit(c(1,1,3,1))
) +
scale_y_continuous(labels=scales::comma) +
scale_fill_discrete(labels=c("Moved from MN", "Moved to MN")) +
labs(title="Average Annual Migration between Minnesota and Other States\nAges 17 to 23") +
annotation_custom
barplot17
library(ggplot2)
barplot17 <- filter(netmig_long, agegroup=="17 to 23") %>%
ggplot(aes(x=geogroup, y=mig, fill=direction)) +
geom_bar(stat="identity", position="dodge") +
geom_text(aes(x=geogroup, y=mig, label=scales::comma(mig)),
position=position_dodge(width=0.9), vjust=-0.25) +
theme(
panel.background = element_blank(),
panel.grid.major.y = element_line(colour = "white",size=.5),
panel.grid.minor.y = element_line(colour = "white", size=.5),
panel.ontop=TRUE,
axis.ticks.x=element_blank(),
axis.ticks.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x=element_text(size=10, color="black"),
axis.text.y=element_blank(),
legend.title=element_blank(),
legend.position="bottom",
plot.margin = unit(c(1,1,3,1), "in")
) +
scale_y_continuous(labels=scales::comma) +
scale_fill_discrete(labels=c("Moved from MN", "Moved to MN")) +
labs(title="Average Annual Migration between Minnesota and Other States\nAges 17 to 23") +
annotation_custom
barplot17
library(ggplot2)
barplot17 <- filter(netmig_long, agegroup=="17 to 23") %>%
ggplot(aes(x=geogroup, y=mig, fill=direction)) +
geom_bar(stat="identity", position="dodge") +
geom_text(aes(x=geogroup, y=mig, label=scales::comma(mig)),
position=position_dodge(width=0.9), vjust=-0.25) +
theme(
panel.background = element_blank(),
panel.grid.major.y = element_line(colour = "white",size=.5),
panel.grid.minor.y = element_line(colour = "white", size=.5),
panel.ontop=TRUE,
axis.ticks.x=element_blank(),
axis.ticks.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x=element_text(size=10, color="black"),
axis.text.y=element_blank(),
legend.title=element_blank(),
legend.position="bottom",
plot.margin = unit(c(1,1,3,1), "in")
) +
scale_y_continuous(labels=scales::comma) +
scale_fill_discrete(labels=c("Moved from MN", "Moved to MN")) +
labs(title="Average Annual Migration between Minnesota and Other States\nAges 17 to 23")
barplot17
library(ggplot2)
barplot17 <- filter(netmig_long, agegroup=="17 to 23") %>%
ggplot(aes(x=geogroup, y=mig, fill=direction)) +
geom_bar(stat="identity", position="dodge") +
geom_text(aes(x=geogroup, y=mig, label=scales::comma(mig)),
position=position_dodge(width=0.9), vjust=-0.25) +
theme(
panel.background = element_blank(),
panel.grid.major.y = element_line(colour = "white",size=.5),
panel.grid.minor.y = element_line(colour = "white", size=.5),
panel.ontop=TRUE,
axis.ticks.x=element_blank(),
axis.ticks.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x=element_text(size=10, color="black"),
axis.text.y=element_blank(),
legend.title=element_blank(),
legend.position="bottom"
) +
scale_y_continuous(labels=scales::comma) +
scale_fill_discrete(labels=c("Moved from MN", "Moved to MN")) +
labs(title="Average Annual Migration between Minnesota and Other States\nAges 17 to 23")
barplot17
library(ggplot2)
barplot17 <- filter(netmig_long, agegroup=="17 to 23") %>%
ggplot(aes(x=geogroup, y=mig, fill=direction)) +
geom_bar(stat="identity", position="dodge") +
geom_text(aes(x=geogroup, y=mig, label=scales::comma(mig)),
position=position_dodge(width=0.9), vjust=-0.25) +
theme(
panel.background = element_blank(),
panel.grid.major.y = element_line(colour = "white",size=.5),
panel.grid.minor.y = element_line(colour = "white", size=.5),
panel.ontop=TRUE,
axis.ticks.x=element_blank(),
axis.ticks.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x=element_text(size=10, color="black"),
axis.text.y=element_blank(),
legend.title=element_blank(),
legend.position="bottom"
) +
scale_y_continuous(labels=scales::comma) +
scale_fill_discrete(labels=c("Moved from MN", "Moved to MN")) +
labs(title="Annual Migration between Minnesota and Other States\nAges 17 to 23",
caption="Source: House Research. 2015 ACS 5-year estimates. IPUMS-USA, University of Minnesota")
barplot17
library(ggplot2)
barplot17 <- filter(netmig_long, agegroup=="17 to 23") %>%
ggplot(aes(x=geogroup, y=mig, fill=direction)) +
geom_bar(stat="identity", position="dodge") +
geom_text(aes(x=geogroup, y=mig, label=scales::comma(mig)),
position=position_dodge(width=0.9), vjust=-0.25) +
theme(
panel.background = element_blank(),
panel.grid.major.y = element_line(colour = "white",size=.5),
panel.grid.minor.y = element_line(colour = "white", size=.5),
panel.ontop=TRUE,
axis.ticks.x=element_blank(),
axis.ticks.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x=element_text(size=10, color="black"),
axis.text.y=element_blank(),
legend.title=element_blank(),
legend.position="bottom"
) +
scale_y_continuous(labels=scales::comma) +
scale_fill_discrete(labels=c("Moved from MN", "Moved to MN")) +
labs(title="Annual Migration between Minnesota and Other States\nAges 17 to 23",
caption="Source: House Research")
barplot17
library(ggplot2)
barplot17 <- filter(netmig_long, agegroup=="17 to 23") %>%
ggplot(aes(x=geogroup, y=mig, fill=direction)) +
geom_bar(stat="identity", position="dodge") +
geom_text(aes(x=geogroup, y=mig, label=scales::comma(mig)),
position=position_dodge(width=0.9), vjust=-0.25) +
theme(
panel.background = element_blank(),
panel.grid.major.y = element_line(colour = "white",size=.5),
panel.grid.minor.y = element_line(colour = "white", size=.5),
panel.ontop=TRUE,
axis.ticks.x=element_blank(),
axis.ticks.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x=element_text(size=10, color="black"),
axis.text.y=element_blank(),
legend.title=element_blank(),
legend.position="bottom"
) +
scale_y_continuous(labels=scales::comma) +
scale_fill_discrete(labels=c("Moved from MN", "Moved to MN")) +
labs(title="Annual Migration between Minnesota and Other States\nAges 17 to 23") +
labs(Caption="Source: House Research")
barplot17
library(ggplot2)
barplot17 <- filter(netmig_long, agegroup=="17 to 23") %>%
ggplot(aes(x=geogroup, y=mig, fill=direction)) +
geom_bar(stat="identity", position="dodge") +
geom_text(aes(x=geogroup, y=mig, label=scales::comma(mig)),
position=position_dodge(width=0.9), vjust=-0.25) +
theme(
panel.background = element_blank(),
panel.grid.major.y = element_line(colour = "white",size=.5),
panel.grid.minor.y = element_line(colour = "white", size=.5),
panel.ontop=TRUE,
axis.ticks.x=element_blank(),
axis.ticks.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x=element_text(size=10, color="black"),
axis.text.y=element_blank(),
legend.title=element_blank(),
legend.position="bottom"
) +
scale_y_continuous(labels=scales::comma) +
scale_fill_discrete(labels=c("Moved from MN", "Moved to MN")) +
labs(title="Annual Migration between Minnesota and Other States, Ages 17 to 23",
caption="Source: House Research")
barplot17
library(ggplot2)
barplot17 <- filter(netmig_long, agegroup=="17 to 23") %>%
ggplot(aes(x=geogroup, y=mig, fill=direction)) +
geom_bar(stat="identity", position="dodge") +
geom_text(aes(x=geogroup, y=mig, label=scales::comma(mig)),
position=position_dodge(width=0.9), vjust=-0.25) +
theme(
panel.background = element_blank(),
panel.grid.major.y = element_line(colour = "white",size=.5),
panel.grid.minor.y = element_line(colour = "white", size=.5),
panel.ontop=TRUE,
axis.ticks.x=element_blank(),
axis.ticks.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x=element_text(size=10, color="black"),
axis.text.y=element_blank(),
legend.title=element_blank()
#legend.position="bottom"
) +
scale_y_continuous(labels=scales::comma) +
scale_fill_discrete(labels=c("Moved from MN", "Moved to MN")) +
labs(title = "Annual Migration between Minnesota and Other States, Ages 17 to 23",
caption = "Source: House Research")
barplot17
library(ggplot2)
barplot17 <- filter(netmig_long, agegroup=="17 to 23") %>%
ggplot(aes(x=geogroup, y=mig, fill=direction)) +
geom_bar(stat="identity", position="dodge") +
geom_text(aes(x=geogroup, y=mig, label=scales::comma(mig)),
position=position_dodge(width=0.9), vjust=-0.25) +
theme(
panel.background = element_blank(),
panel.grid.major.y = element_line(colour = "white",size=.5),
panel.grid.minor.y = element_line(colour = "white", size=.5),
panel.ontop=TRUE,
axis.ticks.x=element_blank(),
axis.ticks.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x=element_text(size=10, color="black"),
axis.text.y=element_blank(),
legend.title=element_blank(),
legend.position="bottom"
) +
scale_y_continuous(labels=scales::comma) +
scale_fill_discrete(labels=c("Moved from MN", "Moved to MN")) +
labs(title = "Annual Migration between Minnesota and Other States, Ages 17 to 23",
caption = "Source: House Research")
barplot17
library(ggplot2)
barplot17 <- filter(netmig_long, agegroup=="17 to 23") %>%
ggplot(aes(x=geogroup, y=mig, fill=direction)) +
geom_bar(stat="identity", position="dodge") +
geom_text(aes(x=geogroup, y=mig, label=scales::comma(mig)),
position=position_dodge(width=0.9), vjust=-0.25) +
theme(
panel.background = element_blank(),
panel.grid.major.y = element_line(colour = "white",size=.5),
panel.grid.minor.y = element_line(colour = "white", size=.5),
panel.ontop=TRUE,
axis.ticks.x=element_blank(),
axis.ticks.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x=element_text(size=10, color="black"),
axis.text.y=element_blank(),
legend.title=element_blank(),
legend.position="bottom",
plot.caption=element_text(size=6)
) +
scale_y_continuous(labels=scales::comma) +
scale_fill_discrete(labels=c("Moved from MN", "Moved to MN")) +
labs(title = "Annual Migration between Minnesota and Other States, Ages 17 to 23",
caption = "Source: House Research")
barplot17
install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2")
library(dplyr)
library(readr)
library(purrr)
library(srvyr)
######################################
#########  SET DIRECTORIES  ##########
######################################
#Home machine
setwd("~/Documents/rstuff/mnmigration")
#work mchine
# setwd("i:/user/williams/data assistance/migration wagenius/")
######################################
######### Migration to MN ############
######################################
#using srvyr
inmigration <- read_csv("usa_00010.csv.gz") %>%
mutate(geogroup =ifelse(PUMARES2MIG==14, "Hennepin",
ifelse(PUMARES2MIG==13, "Ramsey", "Other Counties")),
agegroup = ifelse(AGE<17, "16 and Younger",
ifelse(AGE>=17 & AGE<24, "17 to 23",
ifelse(AGE>=24 & AGE<31, "24 to 30", "31 and Over")
)
)
) %>%
as_survey(weights=PERWT) %>%
group_by(geogroup, agegroup) %>%
summarise(moved_in = survey_total(!(MIGPLAC1 %in% c(0,27)) & MIGPLAC1<100))
######################################
######### Migration from MN ##########
######################################
outmigration <- read_csv("usa_00009.csv.gz") %>%
filter(STATEFIP != 27) %>%
mutate(geogroup =ifelse(MIGPUMA1==1400, "Hennepin",
ifelse(MIGPUMA1==1300, "Ramsey", "Other Counties")),
agegroup = ifelse(AGE<17, "16 and Younger",
ifelse(AGE>=17 & AGE<24, "17 to 23",
ifelse(AGE>=24 & AGE<31, "24 to 30", "31 and Over")
)
)) %>%
as_survey(weights=PERWT)  %>%
group_by(geogroup, agegroup) %>%
summarise(moved_out = survey_total())
######################################
######### Combine and Analyze ########
######################################
netmig <- left_join(inmigration, outmigration) %>%
mutate(net_migration = moved_in-moved_out)
library(tidyr)
netmig_long <- left_join(inmigration, outmigration) %>%
gather(direction, mig, moved_in, moved_out) %>%
mutate(se = ifelse(direction=="moved_in", moved_in_se, moved_out_se)) %>%
select(-moved_in_se, -moved_out_se) %>%
mutate(geogroup = factor(geogroup, levels=c("Other Counties", "Hennepin", "Ramsey")),
direction = factor(direction, levels=c("moved_out", "moved_in")))
library(ggplot2)
barplot17 <- filter(netmig_long, agegroup=="17 to 23") %>%
ggplot(aes(x=geogroup, y=mig, fill=direction)) +
geom_bar(stat="identity", position="dodge") +
geom_text(aes(x=geogroup, y=mig, label=scales::comma(mig)),
position=position_dodge(width=0.9), vjust=-0.25) +
theme(
panel.background = element_blank(),
panel.grid.major.y = element_line(colour = "white",size=.5),
panel.grid.minor.y = element_line(colour = "white", size=.5),
panel.ontop=TRUE,
axis.ticks.x=element_blank(),
axis.ticks.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x=element_text(size=10, color="black"),
axis.text.y=element_blank(),
legend.title=element_blank(),
legend.position="bottom",
plot.caption=element_text(size=6)
) +
scale_y_continuous(labels=scales::comma) +
scale_fill_discrete(labels=c("Moved from MN", "Moved to MN")) +
labs(title = "Annual Migration between Minnesota and Other States, Ages 17 to 23",
caption = "Source: House Research")
barplot17
library(dplyr)
library(readr)
library(purrr)
library(srvyr)
######################################
#########  SET DIRECTORIES  ##########
######################################
#Home machine
setwd("~/Documents/rstuff/mnmigration")
#work mchine
# setwd("i:/user/williams/data assistance/migration wagenius/")
######################################
######### Migration to MN ############
######################################
#using srvyr
inmigration <- read_csv("usa_00010.csv.gz") %>%
mutate(geogroup =ifelse(PUMARES2MIG==14, "Hennepin",
ifelse(PUMARES2MIG==13, "Ramsey", "Other Counties")),
agegroup = ifelse(AGE<17, "16 and Younger",
ifelse(AGE>=17 & AGE<24, "17 to 23",
ifelse(AGE>=24 & AGE<31, "24 to 30", "31 and Over")
)
)
) %>%
as_survey(weights=PERWT) %>%
group_by(geogroup, agegroup) %>%
summarise(moved_in = survey_total(!(MIGPLAC1 %in% c(0,27)) & MIGPLAC1<100))
######################################
######### Migration from MN ##########
######################################
outmigration <- read_csv("usa_00009.csv.gz") %>%
filter(STATEFIP != 27) %>%
mutate(geogroup =ifelse(MIGPUMA1==1400, "Hennepin",
ifelse(MIGPUMA1==1300, "Ramsey", "Other Counties")),
agegroup = ifelse(AGE<17, "16 and Younger",
ifelse(AGE>=17 & AGE<24, "17 to 23",
ifelse(AGE>=24 & AGE<31, "24 to 30", "31 and Over")
)
)) %>%
as_survey(weights=PERWT)  %>%
group_by(geogroup, agegroup) %>%
summarise(moved_out = survey_total())
######################################
######### Combine and Analyze ########
######################################
netmig <- left_join(inmigration, outmigration) %>%
mutate(net_migration = moved_in-moved_out)
library(tidyr)
netmig_long <- left_join(inmigration, outmigration) %>%
gather(direction, mig, moved_in, moved_out) %>%
mutate(se = ifelse(direction=="moved_in", moved_in_se, moved_out_se)) %>%
select(-moved_in_se, -moved_out_se) %>%
mutate(geogroup = factor(geogroup, levels=c("Other Counties", "Hennepin", "Ramsey")),
direction = factor(direction, levels=c("moved_out", "moved_in")))
library(ggplot2)
barplot17 <- filter(netmig_long, agegroup=="17 to 23") %>%
ggplot(aes(x=geogroup, y=mig, fill=direction)) +
geom_bar(stat="identity", position="dodge") +
geom_text(aes(x=geogroup, y=mig, label=scales::comma(mig)),
position=position_dodge(width=0.9), vjust=-0.25) +
theme(
panel.background = element_blank(),
panel.grid.major.y = element_line(colour = "white",size=.5),
panel.grid.minor.y = element_line(colour = "white", size=.5),
panel.ontop=TRUE,
axis.ticks.x=element_blank(),
axis.ticks.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
axis.text.x=element_text(size=10, color="black"),
axis.text.y=element_blank(),
legend.title=element_blank(),
legend.position="bottom",
plot.caption=element_text(size=6)
) +
scale_y_continuous(labels=scales::comma) +
scale_fill_discrete(labels=c("Moved from MN", "Moved to MN")) +
labs(title = "Annual Migration between Minnesota and Other States, Ages 17 to 23",
caption = "Source: House Research")
barplot17
library(ggplot2)
install.packages('scales')
install.packages("scales")
install.packages("scales")
install.packages("scales")
install.packages("scales")
