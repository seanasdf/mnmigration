{
    "collab_server" : "",
    "contents" : "library(tidyverse)\nlibrary(srvyr)\n\n######################################\n######### Migration to MN   ##########\n######### From Other States ##########\n######################################\n\nif (file.exists(\"inmigration.rda\")) {\n  load(\"inmigration.rda\")\n} else {\n  source(\"clean.R\")\n}\n\n#get count of m\ninmigration_by_group <- inmigration %>%\n  mutate(moved_states = ifelse(!(MIGPLAC1 %in% c(0,27)) & MIGPLAC1<100, 1, 0)) %>%\n  as_survey(weights = PERWT) %>%\n  group_by(geogroup, agegroup) %>%\n  summarise(moved_in = survey_total(moved_states))\n\n\n# #Verify that the srvyr match up with the R survey package\n# library(survey)\n# inmigration_by_group_2 <- inmigration %>%\n#   mutate(moved_states = ifelse(!(MIGPLAC1 %in% c(0,27)) & MIGPLAC1<100, 1, 0)) \n# \n# inmigration_by_group_2 <- svydesign(ids = ~1,\n#             data= inmigration_by_group_2,\n#             weights = inmigration$PERWT)\n# \n# inmigration_by_group_2 <- svyby(~moved_states, ~geogroup+agegroup, inmigration_by_group_2, svytotal)\n\n\n######################################\n######### Migration from MN ##########\n######################################\n\nif (file.exists(\"outmigration.rda\")) {\n  load(\"outmigration.rda\")\n} else {\n  source(\"clean.R\")\n}\n\noutmigration_by_group <- outmigration %>% \n  as_survey_design(weights=PERWT)  %>%\n  group_by(geogroup, agegroup) %>%\n  summarise(moved_out = survey_total())\n\n\n# #Verify that the srvyr match up with the R survey package\n# outmigration_by_group_2 <- outmigration %>% mutate(one = 1)\n# \n# outmigration_by_group_2 <- svydesign(ids = ~1,\n#                                   data= outmigration_by_group_2,\n#                                   weights = outmigration_by_group_2$PERWT)\n# \n# outmigration_by_group_2 <- svyby(~one, ~agegroup+geogroup, outmigration_by_group_2, svytotal)\n\n######################################\n######### Graph Net Migration ########\n######################################\nnetmig <- left_join(inmigration_by_group, outmigration_by_group) %>%\n  mutate(net_migration = moved_in-moved_out )\nwrite.csv(netmig, \"netmigration.csv\")\n\n\nnetmig_long <- left_join(inmigration_by_group, outmigration_by_group) %>%\n  mutate(geogroup = ifelse(geogroup==\"Greater MN\", \"Greater Minnesota\", geogroup),\n         geogroup = ifelse(geogroup==\"Metro\", \"Other Metro Counties\", geogroup)) %>%\n  gather(direction, mig, moved_in, moved_out) %>%\n  mutate(se = ifelse(direction==\"moved_in\", moved_in_se, moved_out_se)) %>%\n  select(-moved_in_se, -moved_out_se) %>%\n  mutate(geogroup = factor(geogroup, levels=c(\"Ramsey\",\"Hennepin\",\"Other Metro Counties\",\"Greater Minnesota\")),\n         direction = factor(direction, levels=c(\"moved_out\", \"moved_in\")))\n\n\nlibrary(ggplot2)\nbarplot17_totals <- filter(netmig_long, agegroup==\"17 to 23\") %>%\n  ggplot(aes(x=geogroup, y=mig, fill=direction)) +\n  geom_bar(stat=\"identity\", position=\"dodge\") +\n  geom_text(aes(x=geogroup, y=mig, label=scales::comma(mig)),\n            position=position_dodge(width=0.9), vjust=-0.25) +\n  theme(\n    panel.background = element_blank(),\n    axis.ticks.x=element_blank(),\n    axis.ticks.y=element_blank(),\n    axis.title.x=element_blank(),\n    axis.title.y=element_blank(),\n    axis.text.x=element_text(size=10, color=\"black\"),\n    axis.text.y=element_blank(),\n    legend.title=element_blank(),\n    legend.position=\"bottom\",\n    plot.caption=element_text(size=8, hjust=.5),\n    plot.title = element_text(hjust = 0.5)\n  ) +\n  scale_y_continuous(labels=scales::comma) +\n  scale_fill_discrete(labels=c(\"Left MN for Another State\", \"Moved to MN from Another State\")) +\n  labs(title = \"Average Annual Migration between Minnesota and Other States, 2011-2015\\nPersons Aged 17 to 23\",\n       caption = \"Source: House Research. 2015 American Community Survey 5-year Estimates. IPUMS-USA, University of Minnesota.\") \n\nggsave(\"ages17to23_totals.png\", barplot17_totals,width=8,height=6) \n\nbarplot17_errorbars <- filter(netmig_long, agegroup==\"17 to 23\") %>%\n  ggplot(aes(x=geogroup, y=mig, fill=direction)) +\n  geom_bar(stat=\"identity\", position=\"dodge\") +\n  geom_errorbar(aes(ymin=mig-se, ymax=mig+se), \n                width = .2,\n                position=position_dodge(.9)) +\n  theme(\n    panel.background = element_blank(),\n    axis.ticks.x=element_blank(),\n    axis.ticks.y=element_blank(),\n    axis.title.x=element_blank(),\n    axis.title.y=element_blank(),\n    axis.text.x=element_text(size=10, color=\"black\"),\n    axis.text.y=element_blank(),\n    legend.title=element_blank(),\n    legend.position=\"bottom\",\n    plot.caption=element_text(size=8, hjust=.5),\n    plot.title = element_text(hjust = 0.5)\n  ) +\n  scale_fill_discrete(labels=c(\"Left MN for Another State\", \"Moved to MN from Another State\")) +\n  labs(title = \"Average Annual Migration between Minnesota and Other States, 2011-2015\\nPersons Aged 17 to 23\",\n       caption = \"Source: House Research. 2015 American Community Survey 5-year Estimates. IPUMS-USA, University of Minnesota.\") \n\nggsave(\"ages17to23_errorbars.png\", barplot17_errorbars,width=8,height=6) \n\n\nbarplot24 <- filter(netmig_long, agegroup==\"24 to 30\") %>%\n  ggplot(aes(x=geogroup, y=mig, fill=direction)) +\n  geom_bar(stat=\"identity\", position=\"dodge\") +\n  geom_text(aes(x=geogroup, y=mig, label=scales::comma(mig)),\n            position=position_dodge(width=0.9), vjust=-0.25) +\n  theme(\n    panel.background = element_blank(),\n    axis.ticks.x=element_blank(),\n    axis.ticks.y=element_blank(),\n    axis.title.x=element_blank(),\n    axis.title.y=element_blank(),\n    axis.text.x=element_text(size=10, color=\"black\"),\n    axis.text.y=element_blank(),\n    legend.title=element_blank(),\n    legend.position=\"bottom\",\n    plot.caption=element_text(size=8, hjust=.5),\n    plot.title = element_text(hjust = 0.5)\n  ) +\n  scale_fill_discrete(labels=c(\"Left MN for Another State\", \"Moved to MN from Another State\")) +\n  labs(title = \"Average Annual Migration between Minnesota and Other States, 2011-2015\\nPersons Aged 24 to 30\",\n       caption = \"Source: House Research. 2015 American Community Survey 5-year Estimates. IPUMS-USA, University of Minnesota.\") \n\nggsave(\"ages24to30_totals.png\", barplot24,width=8,height=6)\n\nbarplot24_errorbars <- filter(netmig_long, agegroup==\"24 to 30\") %>%\n  ggplot(aes(x=geogroup, y=mig, fill=direction)) +\n  geom_bar(stat=\"identity\", position=\"dodge\") +\n  geom_errorbar(aes(ymin=mig-se, ymax=mig+se), \n                width = .2,\n                position=position_dodge(.9))+\n  theme(\n    panel.background = element_blank(),\n    axis.ticks.x=element_blank(),\n    axis.ticks.y=element_blank(),\n    axis.title.x=element_blank(),\n    axis.title.y=element_blank(),\n    axis.text.x=element_text(size=10, color=\"black\"),\n    axis.text.y=element_blank(),\n    legend.title=element_blank(),\n    legend.position=\"bottom\",\n    plot.caption=element_text(size=8, hjust=.5),\n    plot.title = element_text(hjust = 0.5)\n  ) +\n  scale_y_continuous(labels=scales::comma) +\n  scale_fill_discrete(labels=c(\"Left MN for Another State\", \"Moved to MN from Another State\")) +\n  labs(title = \"Average Annual Migration between Minnesota and Other States, 2011-2015\\nPersons Aged 24 to 30\",\n       caption = \"Source: House Research. 2015 American Community Survey 5-year Estimates. IPUMS-USA, University of Minnesota.\") \n\n\nggsave(\"ages24to30_errorbars.png\", barplot24_errorbars,width=8,height=6)\n",
    "created" : 1500067174910.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3928295601",
    "id" : "FB527744",
    "lastKnownWriteTime" : 1500069140,
    "last_content_update" : 1500069140568,
    "path" : "I:/User/Williams/Data Assistance/mnmigration/analyze.R",
    "project_path" : "analyze.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}