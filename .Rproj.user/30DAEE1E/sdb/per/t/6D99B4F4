{
    "collab_server" : "",
    "contents" : "library(dplyr)\nlibrary(readr)\nlibrary(purrr)\nlibrary(srvyr)\n\n\n######################################\n######## Run Analysis on Mig #########\n######################################\n\ninmigration <- read_csv(\"usa_00010.csv.gz\") %>%\n  mutate(geogroup =ifelse(PUMARES2MIG==14, \"Hennepin\", \n                          ifelse(PUMARES2MIG==13, \"Ramsey\", \"All Other Counties\")),\n         agegroup = ifelse(AGE<17, \"16 and Younger\",\n                           ifelse(AGE>=17 & AGE<24, \"17 to 23\",\n                                  ifelse(AGE>=24 & AGE<31, \"24 to 30\", \"31 and Over\")\n                           )\n         ),\n         moved = ifelse(!(MIGPLAC1 %in% c(0,27) & MIGPLAC1<100), 1, 0) \n  ) %>%\n  as_survey_design(weights=PERWT) %>%\n  group_by(PUMARES2MIG, agegroup) %>%\n  summarise(moved_in = survey_total(moved)) %>%\n  mutate(migpuma=PUMARES2MIG*100)\n\nlibrary(survey)\noutmigration <- read_csv(\"usa_00009.csv.gz\") %>%\n  filter(STATEFIP != 27) %>%\n  mutate(geogroup =ifelse(MIGPUMA1==1400, \"Hennepin\", \n                          ifelse(MIGPUMA1==1300, \"Ramsey\", \"All Other Counties\")),\n         agegroup = ifelse(AGE<17, \"16 and Younger\",\n                           ifelse(AGE>=17 & AGE<24, \"17 to 23\",\n                                  ifelse(AGE>=24 & AGE<31, \"24 to 30\", \"31 and Over\")\n                           )\n         ),\n         one=1) \n\noutmigration_survey <- svydesign(ids = ~1,\n                                  data= alternate_outmigration,\n                                  weights = alternate_outmigration$PERWT)\n\noutmigration <- svyby(~one, ~MIGPUMA1+agegroup, outmigration_survey, svytotal) %>%\n  mutate(migpuma=MIGPUMA1,\n         moved_out=one)\n\nnetmig <- left_join(outmigration, inmigration) %>%\n  mutate(net_migration = moved_in-moved_out,\n         id=PUMARES2MIG)\n\n######################################\n######### Map Net Migration ##########\n######################################\n\n#load packages to use\nlibrary(rgdal)\nlibrary(ggplot2)\nlibrary(broom)\nlibrary(maptools)\nlibrary(rgeos)\n\n#Read in shapefile for MigPumas\nif (!file.exists(\"shapefile.rda\")) {\n  shapefile <- readOGR(\"./shapefile\", \"ipums_migpuma_pwpuma_2010\")\n  shapefile <- shapefile[shapefile@data$STATEFIP==\"27\",]\n  save(shapefile, file=\"shapefile.rda\")\n} else {\n  load(\"shapefile.rda\")\n}\n\nmnmap <- tidy(shapefile, region=\"PWPUMA\") %>%\n  mutate(id=as.numeric(id)/100) %>%\n  left_join(filter(netmig, agegroup==\"24 to 30\"))\n\nggplot() + \n  geom_polygon(data=mnmap,\n               aes(long, lat, group=group, fill=net_migration),\n               color=\"black\") +\n  coord_equal()",
    "created" : 1498514047221.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3542089752",
    "id" : "6D99B4F4",
    "lastKnownWriteTime" : 1498518298,
    "last_content_update" : 1498518300579,
    "path" : "I:/User/Williams/Data Assistance/mnmigration/mapmigpumas.R",
    "project_path" : "mapmigpumas.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}